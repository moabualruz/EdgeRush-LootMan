spring:
  application:
    name: data-sync-service
  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5432}/${POSTGRES_DB:edgerush}
    username: ${POSTGRES_USER:edgerush}
    password: ${POSTGRES_PASSWORD:edgerush}
    driver-class-name: org.postgresql.Driver
  flyway:
    enabled: true
    locations: classpath:db/migration/postgres
    baseline-on-migrate: true

sync:
  cron: "0 0 4 * * *"
  run-on-startup: ${SYNC_RUN_ON_STARTUP:false}
  wowaudit:
    base-url: ${WOWAUDIT_BASE_URL:https://wowaudit.com}
    guild-profile-uri: ${WOWAUDIT_GUILD_URI:}
    api-key: ${WOWAUDIT_API_KEY:}

# Warcraft Logs Integration Configuration
warcraft-logs:
  enabled: ${WARCRAFT_LOGS_ENABLED:false}
  client-id: ${WARCRAFT_LOGS_CLIENT_ID:}
  client-secret: ${WARCRAFT_LOGS_CLIENT_SECRET:}
  base-url: https://www.warcraftlogs.com/api/v2
  token-url: https://www.warcraftlogs.com/oauth/token
  max-retries: 3
  retry-delay-ms: 1000
  max-concurrent-requests: 5
  request-timeout-seconds: 30
  sync:
    cron: "0 0 */6 * * *"  # Every 6 hours

# Raidbots Integration Configuration
# Note: Raidbots doesn't have a public API for automated submissions
# This integration parses shared Droptimizer report URLs submitted by raiders
raidbots:
  enabled: ${RAIDBOTS_ENABLED:false}
  base-url: https://www.raidbots.com
  # Raiders submit Droptimizer URLs manually via WoWAudit or Discord
  # System parses the public report pages for upgrade values

# Encryption key for sensitive data (should be 32 bytes)
encryption:
  key: ${ENCRYPTION_KEY:default-32-byte-key-change-me!!}

# API Configuration
api:
  version: v1
  base-path: /api
  
  # Admin Mode (DEVELOPMENT ONLY - bypasses authentication)
  admin-mode:
    enabled: ${API_ADMIN_MODE:true}
  
  # Rate Limiting
  rate-limit:
    read-requests-per-second: 100
    write-requests-per-second: 20
    enabled: ${API_RATE_LIMIT_ENABLED:false}
  
  # Pagination
  pagination:
    default-page-size: 20
    max-page-size: 100
  
  # CORS
  cors:
    allowed-origins: ${API_CORS_ORIGINS:http://localhost:3000,http://localhost:8080}
    allowed-methods: GET,POST,PUT,DELETE,OPTIONS,PATCH
    allowed-headers: "*"
    allow-credentials: true
    max-age: 3600

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:default-secret-key-change-in-production-must-be-at-least-256-bits-long-for-security}
  expiration-ms: 86400000  # 24 hours
  issuer: edgerush-lootman

# OpenAPI Configuration
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: alpha
    tags-sorter: alpha
  show-actuator: true

# FLPS Algorithm Configuration
flps:
  rms:
    attendance: 0.45      # Weight for Attendance Consistency Score in RMS
    mechanical: 0.35      # Weight for Mechanical Adherence Score in RMS
    preparation: 0.20     # Weight for External Preparation Score in RMS
  ipi:
    upgrade-value: 0.45   # Weight for upgrade value in IPI calculation
    tier-bonus: 0.35      # Weight for tier bonus in IPI calculation
    role-multiplier: 0.20 # Weight for role multiplier in IPI calculation
  role-multipliers:
    tank: 1.2             # Tank role gets 20% bonus (rare/critical role)
    healer: 1.1           # Healer role gets 10% bonus (important role)
    dps: 1.0              # DPS baseline multiplier
  thresholds:
    eligibility-attendance: 0.8     # Minimum attendance % for loot eligibility
    eligibility-activity: 0.0       # Minimum activity score for eligibility
    recency-decay-days: 30          # Days for recency decay factor calculation
    max-attendance-bonus: 1.0       # Maximum attendance score cap
    min-mechanical-score: 0.0       # Minimum mechanical adherence score
    max-preparation-score: 1.0      # Maximum preparation score cap
